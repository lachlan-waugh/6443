<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css" />
    <title>QuoccaCorp</title>
</head>

<body>
    <main class="container">
        <nav>
            <ul>
                <li><strong>QuoccaCorp</strong></li>
            </ul>
            <ul>
                <li><a href="/">home</a></li>
            </ul>
        </nav>

        <article class="pico-background-green-350" style="display: None;">{{ flag }}</article>
        <article class="pico-background-red-400" style="display: None;">{{ error }}</article>

        <p>Please register an account.</p>

        <form action="/register" method="post">
          <div class="grid">
            <label>
              First name
              <input type="text" name="fname" placeholder="Text" aria-label="Text">
            </label>

            <label>
              Last name
              <input type="text" name="lname" placeholder="Text" aria-label="Text">
            </label>
          </div>

          <div class="grid">
            <label>
              Email
              <input type="email" name="email" placeholder="Email" aria-label="Email" autocomplete="email">
            </label>

            <label>
              Password
              <input type="password" name="password" placeholder="Password" aria-label="Password">
            </label>
          </div>

          <label>
            <output>Phone number: 0</output>
            <input type="number" name="mobile" placeholder="0" aria-label="Mobile" />
          </label>

          <label>
            City
            <input type="text" name="city" placeholder="Text" aria-label="Text">
          </label>

          <input type="submit" value="Update">
        </form>
    </main>

    <script>
    document.getElementById('userForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        let fields = {}
        Array
          .from(document.querySelectorAll('input'))
          .filter((e) => e.type !== 'submit' && e.value)
          .map((e) => {
            fields[e.name] = e.value
        });

        let response = await fetch('/update', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(fields)
        });

        let data = await response.json();
        document.getElementById('result').innerText = data.message;

        // Check if prototype pollution affected objects
        let isAdminResponse = await fetch('/check-admin');
        let isAdminData = await isAdminResponse.json();
        alert('Admin status: ' + isAdminData.isAdmin);
      });
    </script>
</body>

</html>
