<!DOCTYPE html>
{% autoescape false %}
<html>
  <head>
    <meta charset="utf-8">
    <title>secure commenting service</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>

  <body>
    <header>
      <h1>secure commenting service</h1>
      <p>we even have dompurify now</p>
    </header>

    <form method="GET">
      <input type="text" name="q" placeholder="search query" autocomplete="off" />
      <input type="submit" value="filter comments" />
    </form>

    {% if not query %}
      <h3>Showing all comments:</h3>
    {% else %}
      <h3>Showing comments containing "{{ query }}":</h3>
    {% endif %}

    <div id="comments"></div> 

    <form action="/" method="POST">
      <input type="text" name="comment" placeholder="comment" autocomplete="off" />
      <input type="submit" value="new comment" />
    </form>
  </body>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.0.12/purify.min.js"></script>
  <script>
    {{ comments }}.forEach((comment) => { 
      const div = document.createElement('div');
      div.appendChild(document.createElement('p'));
      div.children[0].innerHTML = DOMPurify.sanitize(atob(comment)).toString();
      document.querySelector('#comments').appendChild(div);
    })
  </script>
</html>
{% endautoescape %}
