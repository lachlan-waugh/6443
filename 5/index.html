<!doctype html><html lang=en><head><meta charset=utf-8><title>5: serverside</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1305>We&rsquo;ll get started at 13:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=more-server-side>more server-side</h1><h3 id=68443-week5>6[84]43 week5</h3></section><section><h1 id=house-cleaning>House cleaning</h1><section data-shortcode-section></section><section><h2 id=report-groups>Report groups</h2><blockquote><p>If you aren&rsquo;t in a group please let me know</p></blockquote></section><section><h2 id=midterm>Midterm</h2><blockquote><p>How&rsquo;d you all find it (trivial enough?)</p></blockquote></section></section><section><h2 id=injection>Injection</h2><ul><li>Command Injection</li><li>SSTI</li><li>PHP Injection</li></ul></section><section><section data-shortcode-section><h2 id=bash-injection>bash injection</h2><ul><li>If you&rsquo;re ever using os.system() (or similar) to call shell functions containing user input<ul><li>first of all, probably don&rsquo;t</li><li>second of all, it&rsquo;s kinda vulnerable</li></ul></li></ul></section><section><h3 id=demo><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/bash_injection>Demo</a></h3></section><section><h3 id=reverse-shells>Reverse shells</h3></section><section><h3 id=stabilizing-your-shell>Stabilizing your shell</h3></section></section><section><section data-shortcode-section><h3 id=ssti-server-side-template-injection>SSTI (Server-side template injection)</h3><ul><li><p>Templating engines (eg. Jinja2, Pug) use templates to inject code and variables into static files</p></li><li><p>Jinja2: <code>{{</code>&lt;CODE HERE><code>}}</code> e.g. <code>{{7*7}}</code> => <code>49</code></p></li><li><p><em>what if we tricked the template rendering into thinking our user-supplied content was code?</em></p></li></ul></section><section><h2 id=demo><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssti>Demo</a></h2></section></section><section><section data-shortcode-section><h2 id=basic-php-injection>Basic PHP injection</h2><ul><li>PHP is a very different language to most</li><li>It&rsquo;s kinda like a html server (where the file path is the url path)</li><li>This means if you add a new .php file somewhere, and navigate there, it&rsquo;ll execute</li></ul></section><section><h2 id=demo><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/php_webshell>Demo</a></h2></section></section><section><section data-shortcode-section><h3 id=helpful-stuff>Helpful stuff</h3><ul><li>reverse shells</li><li>hosting content (ngrok, requestbin)</li></ul></section><section><h2 id=reverse-shells>reverse shells</h2><ul><li>Sometimes you can get command injection, but it&rsquo;s really tedious</li><li>wouldn&rsquo;t it be easier if you could just get send your commands directly via terminal?</li></ul><blockquote><p>checkout <a href="https://www.explainshell.com/explain?cmd=nc+-lnvp+9999">explainshell</a> and <a href=https://revshells.com>revshells</a></p></blockquote></section><section><h2 id=demo><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/revshell>Demo</a></h2></section><section><h3 id=how-to-host-content>How to host content</h3><ul><li><code>python3 -m http.server + NGROK</code></li><li>localtunnel</li><li><code>RequestBin</code></li><li><code>GitHub pages</code> (needs to build everytime though so it&rsquo;s slow)</li></ul></section><section><h2 id=demo-1>Demo?</h2></section></section><section><h2 id=file-based-vulnerabilities>File-based vulnerabilities</h2><ul><li>File disclosure (e.g. XXE)</li><li>Local file inclusion (e.g. PHP)</li><li>File uploads</li></ul></section><section><section data-shortcode-section><h3 id=file-disclosure>File disclosure</h3><p>somehow include a page</p><ul><li><code>?page=index.html</code> (what about <code>?page=../../../etc/passwd</code>)</li><li>image upload <code>https://a.com/catpicture.png</code> (what about <code>file:///etc/passwd</code>)</li><li>error messages</li></ul></section><section><h3 id=xml-extended-markup-language>XML (Extended Markup Language)</h3><ul><li>a data format kinda like json, that looks like HTML</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;<span style=color:#f92672>users</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>user</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>username</span>&gt;melon&lt;/<span style=color:#f92672>username</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>password</span>&gt;Hunter2&lt;/<span style=color:#f92672>password</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>user</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>user</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;2&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>username</span>&gt;admin&lt;/<span style=color:#f92672>username</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>password</span>&gt;admin&lt;/<span style=color:#f92672>password</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>user</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>users</span>&gt;
</span></span></code></pre></div></section><section><h2 id=xxe-xml-external-entities>XXE (XML External Entities)</h2><ul><li>DTD - Document Type Definition</li><li><em>Internal Entity</em>: an entity declared within the DTD (like a variable)</li><li><em>External Entity</em>: an entity declared outside the DTD (files, stuff on other websites)</li></ul></section><section><h3 id=internal-entities>Internal entities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY string &#34;hey, don&#39;t read my diary&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>diary</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>entry</span>&gt;&amp;string;&lt;/<span style=color:#f92672>entry</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>diary</span>&gt;
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>hey, don&#39;t read my diary
</span></span></code></pre></div></section><section><h3 id=external-entities>External entities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY funCatFact &#34;https://FunCatFact.com/generate&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>diary</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>entry</span>&gt;&amp;funCatFact;&lt;/<span style=color:#f92672>entry</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>diary</span>&gt;
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Cats are asleep for 70% of their lives.
</span></span></code></pre></div></section><section><h3 id=ssi>SSI</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY flag SYSTEM &#34;file:///flag.txt&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>diary</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>entry</span>&gt;&amp;flag;&lt;/<span style=color:#f92672>entry</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>diary</span>&gt;
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>COMP6443{....}
</span></span></code></pre></div></section><section><h3 id=parameterised-entities>Parameterised entities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY % difficulty &#34;trivial&#34; &gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>&lt;!ENTITY % meme &#34;web apps is %difficulty;&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>diary</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>entry</span>&gt;%meme;&lt;/<span style=color:#f92672>entry</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>diary</span>&gt;
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>web apps is trivial
</span></span></code></pre></div></section></section><section><section data-shortcode-section><h3 id=local-file-inclusion>Local file inclusion</h3><p>PHP has this reaelly funny <code>include()</code> function</p><ul><li>Think of it like importing another page</li><li>Strangely, it can do a lot more than that</li></ul></section><section><h3 id=demo>Demo</h3></section></section><section><h2 id=now-do-some-challenges>Now do some challenges</h2><blockquote><p>What you all came for lol</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>