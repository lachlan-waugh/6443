<!doctype html><html lang=en><head><meta charset=utf-8><title>8: clientside</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-16805>we&rsquo;ll get started at 1[68]:05</h2></section><section data-noprocess data-shortcode-slide class=center><h2 id=client-side-protections>client-side protections</h2><h3 id=68443-week8>6[84]43 week8</h3></section><section><h1 id=house-cleaning>house cleaning</h1><section data-shortcode-section><h2 id=due-dates>due dates</h2><ul><li>the rest of the topic04 challenges should be out</li><li>they&rsquo;re due sunday week9.</li></ul></section><section><h2 id=reports-general-feedback>reports (general feedback)</h2><ul><li>consider context when determining impact, not everything is critical.</li><li>keep technical stuff out of impact/remediation. It should mostly be in steps to reproduce.</li></ul></section></section><section><section data-shortcode-section><h2 id=mitigating-xss>mitigating xss</h2><p>basic waf stuff</p><ul><li><em>sanitisation</em>: stripping out unsafe tags/attributes<ul><li>&lt;script>alert(1)&lt;script> → alert(1)</li></ul></li><li><em>encoding</em>: escaping control characters<ul><li>&lt;> → &amp;lt;&amp;gt;</li></ul></li><li><em>validation</em>: allow/block-listing of content<ul><li>block requests if you detect bad content</li></ul></li></ul></section><section><h3 id=dont-use-raw-user-input>don&rsquo;t use raw user input</h3><ul><li><p><code>.innerHTML</code> treats content as HTML (control)</p><ul><li>use <code>.innerText</code> which treats it as data</li></ul></li><li><p>sanitize your input with a library (DOMPurify???)</p></li><li><p>don&rsquo;t write vanilla JS, use a framework.</p><ul><li>again, even if you use a framework, make sure the functions you&rsquo;re using sanitize the input</li></ul></li></ul></section><section><h3 id=breaking-mitigations>breaking mitigations</h3><ul><li>content stripped/blocked<ul><li>embed dummy characters: <code>&lt;SCRscriptIPT></code></li><li>use alternating case: <code>&lt;ScRiPt></code></li><li>different tag <code>&lt;img onerror=...></code></li><li>different event handler <code>&lt;body onload=...></code></li></ul></li></ul><p><a href=https://github.com/payloadbox/xss-payload-list>here&rsquo;s a couple more</a></p></section><section><h3 id=x-xss-protection>X-XSS-Protection</h3><ul><li>no, it&rsquo;s <a href="https://news.ycombinator.com/item?id=20472947">terrible</a></li></ul><blockquote><p>&lsquo;First, XSS &lsquo;protection&rsquo; is about to not be implemented by most browsers&mldr;&rsquo;</p></blockquote><blockquote><p>&lsquo;Worse, the XSS &lsquo;protection&rsquo; can be used to create security flaws&mldr;&rsquo;</p></blockquote></section></section><section><section data-shortcode-section><h3 id=csrf-mitigations>csrf mitigations</h3><p>csrf tokens</p><p>Supply a single-use &rsquo;nonce&rsquo; value.</p><ul><li>when the page is loaded, generate the nonce</li><li>when a request is made, it must include the nonce</li><li>it&rsquo;ll be stored as a: cookie, header, <code>&lt;input></code></li></ul></section><section><h2 id=quick-demo>quick demo</h2></section><section><h3 id=breaking-mitigations>breaking mitigations</h3><ul><li>bad programming, they might be doing it wrong<ul><li>re-use a previous token (if it doesn&rsquo;t expire)</li><li>create your own?</li><li>they might not even check it.</li></ul></li></ul></section></section><section><h3 id=clickjacking-mitigations>clickjacking mitigations</h3><ul><li>csp frame-src / X-Frame-Options</li><li>same-site cookies</li><li>framebusters (~js magic~)</li></ul></section><section><section data-shortcode-section><h2 id=csp>CSP</h2><p>Content Security Policy</p><ul><li><p>limits where a site can load content from, e.g.</p><ul><li>only scripts from this website</li><li>only images from <code>https://b.com/a/path/</code></li><li>only elements with a certain nonce value</li></ul></li><li><p>generally blocks iframes, inline scripts, <code>eval()</code></p></li><li><p>powerful & hard to bypass (if devs were smart)</p></li></ul></section><section><h3 id=how-is-it-defined>how is it defined</h3><p>policy directives made of directive and value</p><p>e.g. <code>script-src: unsafe-inline</code></p><ul><li><code>script-src</code> is the <code>directive</code></li><li><code>unsafe-inline</code> is the <code>value</code></li><li>the whole thing is the policy directive</li></ul></section><section><h3 id=what-directives-are-there>what directives are there</h3><ul><li>script-src</li><li>frame-src</li><li>img-src</li><li>object-src</li><li>default-src</li></ul><blockquote><p>read more <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy>here</a></p></blockquote></section><section><h3 id=what-values-are-there>what values are there</h3><ul><li><em>none</em>: blocks all loading</li><li><em>self</em>: only from the current origin</li><li><em>strict-dynamic</em>: anything w/ a hash/nonce (& anything they load/create)</li><li><em>unsafe-inline</em>: e.g. &lt;script>alert(1)&lt;/script></li><li><em>unsafe-eval</em>: e.g. eval(), setTimeout()</li></ul></section><section><h3 id=where-is-it-defined>where is it defined</h3><ul><li><p>http header</p><ul><li><code>Content-Security-Policy: ???-src &lt;policy directive></code></li></ul></li><li><p>or in a tag</p><ul><li><code>&lt;meta http-equiv="Content-Security-Policy" content="???-src &lt;directive>"></code></li><li>though not as powerful</li></ul></li></ul></section></section><section><h3 id=how-to-break-it>how to break it?</h3><ul><li>corrupting the HTTP header (response splitting?)</li><li>overwriting the <code>&lt;meta></code> tag?</li></ul></section><section><section data-shortcode-section><h3 id=jsonp>jsonp</h3><ul><li><p>what did people do before CORS was available?</p></li><li><p>json with padding</p><ul><li>you can&rsquo;t load a resource from another domain</li><li>but you can load a script</li><li>so, return a script which loads the content? &#x1f9e0;</li></ul></li></ul></section><section><h3 id=what>what</h3><ul><li><p>how do you load the content? you run a function which takes the data as an argument.</p></li><li><p>since we&rsquo;re loading the data, we define what function is being used to load it.</p></li></ul></section><section><h3 id=jsonp-example>jsonp example</h3><ul><li>define the function using a <code>callback</code> parameter</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;!-- https://melon.com/numbers?callback=load_data --&gt;</span>
</span></span><span style=display:flex><span>load_data([1, 2, 3, 4, 5])
</span></span></code></pre></div><p> </p><ul><li>the script below will invoke <code>load_data([...])</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://melon.com/numbers?callback=load_data&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div></section><section><h3 id=demo>demo</h3></section></section><section><section data-shortcode-section><h2 id=http-response-splitting>http response splitting</h2><ul><li>an exploit when user-controlled input is used in a server&rsquo;s HTTP response header</li><li>how does program determine:<ul><li>the end of a header?</li><li>the end of the headers/start of the body?</li></ul></li></ul></section><section><ul><li>headers are separated by <code>\r\n</code> (<code>CR\LF</code>)</li><li>body is separated with two <code>\r\n</code>&rsquo;s</li><li>what if our input included <code>\r\n\r\n</code>?</li></ul><p> </p><img src=../assets/img/week8/response-splitting.png style=scale:200%></section><section><h3 id=demo>demo</h3></section></section><section><h2 id=challenges>Challenges</h2><blockquote><p>gl with report & support-v2 lul</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>