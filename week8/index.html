<!doctype html><html lang=en><head><meta charset=utf-8><title>08: clientside</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-1805>We&rsquo;ll get started at 18:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=week08>Week08</h1><h3 id=comp6443-h18a>COMP6443 H18A</h3></section><section><h1 id=house-cleaning>House cleaning</h1><section data-shortcode-section><h2 id=due-dates>Due Dates</h2><ul><li>All of the topic04 challenges are out</li><li>They&rsquo;re due Sunday Week08.</li></ul></section><section><h2 id=reports-general-feedback>Reports (general feedback)</h2><ul><li>Consider context when determining impact, not everything is critical.</li><li>Keep technical stuff out of impact/remediation. It should mostly be in steps to reproduce.</li></ul></section></section><section><h2 id=mitigating-csrf>Mitigating CSRF</h2><section data-shortcode-section><h3 id=csrf-tokens>CSRF Tokens</h3><p>Supply a single-use &rsquo;nonce&rsquo; value.</p><ul><li>When the page is loaded, generate the nonce</li><li>When a request is made, it must include the nonce</li><li>It&rsquo;ll be stored as a: cookie, header, <code>&lt;input></code></li></ul></section><section><h3 id=csrf-mitigations>CSRF Mitigations</h3><ul><li>CSRF Tokens, a nonce value supplied as input</li><li>Randomly generated when the page is loaded<ul><li>stored as a cookie, header, <code>&lt;input></code></li></ul></li><li>When a request is made, backend verifies the nonce</li></ul></section><section><h2 id=quick-demo>Quick demo</h2></section><section><h3 id=breaking-mitigations>Breaking mitigations</h3><ul><li>Bad programming, they might be doing it wrong<ul><li>Re-use a previous token (if it doesn&rsquo;t expire)</li><li>Create your own?</li><li>They might not even check it.</li></ul></li></ul></section></section><section><h2 id=mitigating-xss>Mitigating XSS</h2><section data-shortcode-section><h3 id=basic-waf-stuff>Basic WAF stuff</h3><ul><li><em>Sanitisation</em>: stripping out unsafe tags/attributes<ul><li>&lt;script>alert(1)&lt;script> → alert(1)</li></ul></li><li><em>Encoding</em>: escaping control characters<ul><li>&lt;> → &amp;lt;&amp;gt;</li></ul></li><li><em>Validation</em>: allow/block-listing of content<ul><li>block requests if you detect bad content</li></ul></li></ul></section><section><h3 id=dont-use-raw-user-input>Don&rsquo;t use raw user input</h3><ul><li><p><code>.innerHTML</code> treats content as HTML (control)</p><ul><li>use <code>.innerText</code> which treats it as data</li></ul></li><li><p>sanitize your input with a library (DOMPurify???)</p></li><li><p>don&rsquo;t write vanilla JS, use a framework.</p><ul><li>again, even if you use a framework, make sure the functions you&rsquo;re using sanitize the input</li></ul></li></ul></section><section><h3 id=breaking-mitigations>Breaking mitigations</h3><ul><li>Content stripped/blocked<ul><li>embed dummy characters: <code>&lt;SCRscriptIPT></code></li><li>use alternating case: <code>&lt;ScRiPt></code></li><li>different tag <code>&lt;img onerror=...></code></li><li>different event handler <code>&lt;body onload=...></code></li></ul></li></ul><p><a href=https://github.com/payloadbox/xss-payload-list>here&rsquo;s a couple more</a></p></section><section><h3 id=x-xss-protection>X-XSS-Protection</h3><ul><li>no, it&rsquo;s <a href="https://news.ycombinator.com/item?id=20472947">terrible</a></li></ul><blockquote><p>&lsquo;First, XSS &lsquo;protection&rsquo; is about to not be implemented by most browsers&mldr;&rsquo;</p></blockquote><blockquote><p>&lsquo;Worse, the XSS &lsquo;protection&rsquo; can be used to create security flaws&mldr;&rsquo;</p></blockquote></section></section><section><h2 id=csp>CSP</h2><section data-shortcode-section><ul><li><p>Limits where you can load content from, e.g.</p><ul><li>only scripts from local scripts</li><li>only images from <code>example.com/path</code></li></ul></li><li><p>only elements with a certain nonce value</p></li><li><p>generally blocks iframes, inline scripts, <code>eval()</code></p></li><li><p>basically it&rsquo;s kinda smurfing, it&rsquo;s hard to bypass</p></li></ul></section><section><h3 id=where-is-it-defined>Where is it defined</h3><ul><li><p>HTTP header</p><ul><li><code>Content-Security-Policy: ???-src &lt;directive></code></li></ul></li><li><p>Or in a tag</p><ul><li><code>&lt;meta http-equiv="Content-Security-Policy" content="???-src &lt;directive>"></code></li><li>though not as powerful</li></ul></li></ul></section><section><h3 id=how-to-break-it>How to break it?</h3><ul><li>Corrupting the HTTP header (response splitting?)</li><li>Overwriting the <code>&lt;meta></code> tag?</li></ul></section></section><section><h2 id=http-response-splitting>HTTP Response Splitting</h2><section data-shortcode-section><ul><li>An exploit when user-controlled input is used in a server&rsquo;s HTTP response header</li><li>how does a program determine:<ul><li>the end of a header?</li><li>the end of the headers/start of the body?</li></ul></li></ul></section><section><ul><li>Headers are separated by <code>\r\n</code> (<code>CR\LF</code>)</li><li>Body is separated with two <code>\r\n</code>&rsquo;s</li><li>What if our input included <code>\r\n\r\n</code>?</li></ul><p> </p><img src=../img/week08/response-splitting.png style=scale:200%></section><section><h3 id=demo>Demo</h3></section></section><section><h2 id=click-jacking>Click-jacking</h2><section data-shortcode-section><ul><li><p>A fake form sitting under a real form</p></li><li><p>if you try to interact with the fake form, you&rsquo;ll accidentally interact with the real one.</p></li><li><p>This could be either local, or external</p><ul><li>local: same form switch confirm/cancel buttons</li><li>external: an invisible iframe with a higher z-index</li></ul></li></ul></section><section><h3 id=demo>Demo</h3></section><section><h3 id=defense>Defense</h3><ul><li>CSP frame-src / X-Frame-Options</li><li>SameSite cookies</li><li>Framebusters (~JS magic~)</li></ul></section></section><section><h2 id=challenges>Challenges</h2><blockquote><p>gl with report & support-v2 lul</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>